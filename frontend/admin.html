<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åå°ç®¡ç†</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { transition: none !important; box-shadow: none !important; }
        body { font-family: 'å¾®è½¯é›…é»‘', sans-serif; background-color: #f0f2f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .navbar { display: flex; justify-content: space-between; align-items: center; background: #343a40; color: white; padding: 15px 30px; border-radius: 4px; margin-bottom: 20px; }
        .btn-logout { background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        .panel { background: white; padding: 20px; border-radius: 4px; border: 1px solid #ddd; margin-bottom: 30px; }
        h3 { border-left: 5px solid #007bff; padding-left: 10px; margin-bottom: 20px; }
        .dashboard-grid { display: flex; gap: 20px; margin-bottom: 20px; }
        .chart-box { flex: 1; height: 300px; background: #fff; border-radius: 4px; padding: 10px; border: 1px solid #eee; }
        .metric-cards { display: flex; gap: 15px; margin-bottom: 20px; }
        .metric-card { flex: 1; background: #667eea; color: white; padding: 20px; border-radius: 4px; text-align: center; }
        .metric-card p { margin: 10px 0 0; font-size: 2em; font-weight: bold; }
        .card-red { background: #ff416c; }
        .card-green { background: #11998e; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; font-weight: bold; color: #555; }
        .badge { padding: 5px 10px; border-radius: 4px; color: white; font-size: 0.9em; }
        .bg-wait { background: #ffc107; color: #333; } .bg-pass { background: #28a745; } .bg-reject { background: #dc3545; } .bg-member { background: #17a2b8; } .bg-done { background: #6c757d; }
        button { cursor: pointer; border: none; padding: 5px 10px; border-radius: 4px; color: white; margin-right: 5px; }
        .btn-pass { background: #28a745; } .btn-reject { background: #dc3545; } .btn-delete { background: #dc3545; } .btn-kick { background: #dc3545; }
        .thumb-img { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }
        .admin-form { display: flex; gap: 10px; background: #f8f9fa; padding: 15px; border-radius: 4px; align-items: flex-end; margin-bottom: 15px; border: 1px solid #eee; flex-wrap: wrap; }
        .admin-form div { display: flex; flex-direction: column; margin-bottom: 5px; }
        .admin-form label { font-size: 0.85em; color: #666; margin-bottom: 3px; }
        .admin-form input, .admin-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn-publish { background: #e83e8c; height: 35px; padding: 0 20px; font-weight: bold; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn-add-animal { background: #20c997; height: 35px; padding: 0 20px; font-weight: bold; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
<div class="container">
    <div class="navbar"><h2>ğŸ› ï¸ ç®¡ç†å‘˜æ§åˆ¶å°</h2><div><span id="admin-name">ç®¡ç†å‘˜</span> <button class="btn-logout" onclick="logout()">é€€å‡º</button></div></div>
    
    <div class="panel"><h3>ğŸ“Š æ•°æ®ä»ªè¡¨ç›˜</h3><div class="metric-cards"><div class="metric-card"><h4>ğŸ‘¥ æ€»ç”¨æˆ·</h4><p id="stat-users">0</p></div><div class="metric-card card-green"><h4>ğŸ¾ æ•‘åŠ©åŠ¨ç‰©</h4><p id="stat-animals">0</p></div><div class="metric-card card-red"><h4>ğŸ“¦ æ”¶åˆ°æèµ </h4><p id="stat-donations">0</p></div><div class="metric-card"><h4>ğŸ™‹ å¿—æ„¿è€…</h4><p id="stat-volunteers">0</p></div></div><div class="dashboard-grid"><div id="chart-pie" class="chart-box"></div><div id="chart-bar" class="chart-box"></div></div></div>
    
    <div class="panel">
        <h3 style="border-color:#20c997;color:#0ca678">ğŸ¾ åŠ¨ç‰©æ¡£æ¡ˆç®¡ç†</h3>
        <div class="admin-form">
            <div><label>åå­— *</label><input id="ani-name" placeholder="å¦‚: å°ç™½" style="width: 100px;"></div>
            <div><label>å“ç§</label><input id="ani-breed" placeholder="å¦‚: ç”°å›­çŒ«" style="width: 100px;"></div>
            <div><label>å¹´é¾„</label><input id="ani-age" placeholder="å¦‚: 2å²" style="width: 80px;"></div>
            <div><label>æ€§åˆ«</label><select id="ani-gender" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;"><option value="å…¬">å…¬</option><option value="æ¯">æ¯</option><option value="æœªçŸ¥">æœªçŸ¥</option></select></div>
            <div><label>å¥åº·çŠ¶å†µ</label><input id="ani-health" placeholder="å¦‚: å¥åº·" style="width: 100px;"></div>
            <div><label>ç–«è‹—æƒ…å†µ</label><input id="ani-vaccine" placeholder="å¦‚: å·²æ¥ç§" style="width: 100px;"></div>
            <div><label>æ€§æ ¼ç‰¹ç‚¹</label><input id="ani-personality" placeholder="å¦‚: æ´»æ³¼ç²˜äºº" style="width: 120px;"></div>
            <div><label>å›¾ç‰‡URL</label><input id="ani-img" placeholder="å›¾ç‰‡é“¾æ¥"></div>
            <button class="btn-add-animal" onclick="addAnimal()">â• å½•å…¥ç³»ç»Ÿ</button>
        </div>
        <table><thead><tr><th>ID</th><th>ä¿¡æ¯</th><th>å“ç§</th><th>æ€§åˆ«/å¹´é¾„</th><th>å¥åº·/ç–«è‹—</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead><tbody id="animal-list"></tbody></table>
    </div>

    <div class="panel"><h3 style="border-color:#007bff;color:#0056b3">ğŸ“‹ é¢†å…»ç”³è¯·å®¡æ ¸</h3><table><thead><tr><th>ID</th><th>ç”³è¯·äºº</th><th>å­¦é™¢</th><th>ç­çº§</th><th>åŠ¨ç‰©</th><th>ç†ç”±</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead><tbody id="audit-list"></tbody></table></div>
    
    <div class="panel"><h3 style="border-color:#e83e8c;color:#d63384">ğŸ“¦ ç‰©èµ„æèµ è®°å½•</h3><table><thead><tr><th>ID</th><th>çˆ±å¿ƒäººå£«</th><th>æèµ ç‰©å“</th><th>æ•°é‡</th><th>å¤‡æ³¨</th><th>æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody id="donation-list"></tbody></table></div>
    
    <div class="panel">
        <h3 style="border-color:#007bff;color:#007bff">ğŸ“¢ å¯»å® å¯äº‹ç®¡ç†</h3>
        <div class="admin-form">
            <div><label>ç±»å‹</label><select id="lost-type" style="width:80px"><option value="å¯»å® ">å¯»å® </option><option value="å¯»ä¸»">å¯»ä¸»</option></select></div>
            <div><label>æ ‡é¢˜</label><input id="lost-title" placeholder="å¦‚: ä¸¢å¤±æ©˜çŒ«" style="width:150px"></div>
            <div><label>æè¿°</label><input id="lost-desc" placeholder="ç®€è¦æè¿°" style="width:200px"></div>
            <div><label>è”ç³»æ–¹å¼</label><input id="lost-contact" placeholder="ç”µè¯/å¾®ä¿¡"></div>
            <button class="btn-publish" onclick="publishLostAdmin()">ğŸš€ å‘å¸ƒ(å…å®¡)</button>
        </div>
        <table><thead><tr><th>ID</th><th>çŠ¶æ€</th><th>ç±»å‹</th><th>æ ‡é¢˜</th><th>æè¿°</th><th>è”ç³»æ–¹å¼</th><th>æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody id="lost-list"></tbody></table>
    </div>

    <div class="panel"><h3 style="border-color:#e83e8c;color:#d63384">ğŸ“¢ ä»»åŠ¡å‘å¸ƒ</h3><div class="admin-form"><div><label>æ ‡é¢˜</label><br><input id="task-title"></div><div><label>è¯¦æƒ…</label><br><input id="task-desc"></div><div><label>äººæ•°</label><br><input id="task-count" type="number" style="width:60px"></div><button class="btn-publish" onclick="publishTask()">ğŸš€ å‘å¸ƒ</button></div><table><thead><tr><th>ID</th><th>æ ‡é¢˜</th><th>äººæ•°</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead><tbody id="task-list"></tbody></table></div>
    
    <div class="panel"><h3 style="border-color:#fd7e14;color:#d9480f">ğŸ“œ å¿—æ„¿è€…æ¡£æ¡ˆ</h3><table><thead><tr><th>ID</th><th>å§“å</th><th>æ—¶é—´</th><th>èº«ä»½</th><th>æ“ä½œ</th></tr></thead><tbody id="volunteer-archive"></tbody></table></div>
    <div class="panel"><h3 style="border-color:#fd7e14;color:#d9480f">ğŸ™‹ å¿—æ„¿è€…å®¡æ ¸</h3><table><thead><tr><th>ID</th><th>ç”³è¯·äºº</th><th>ç†ç”±</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead><tbody id="volunteer-audit"></tbody></table></div>
    
    <div class="panel"><h3 style="border-color:#6610f2;color:#6610f2">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h3><table id="table-users"><thead><tr><th>ID</th><th>å§“å</th><th>è§’è‰²</th><th>æ³¨å†Œæ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody id="user-list"></tbody></table></div>
</div>
<script>
    const SERVER_URL = "http://127.0.0.1:8000"; let currentUser=null, userMap={}, animalMap={};
    const PAGE_VERSION = new Date().getTime(); 
    function getImgUrl(url) { return url + (url.includes('?') ? '&' : '?') + '_v=' + PAGE_VERSION; }
    function getApiUrl(url) { return url + (url.includes('?') ? '&' : '?') + '_t=' + new Date().getTime(); }
    (function(){ const s=localStorage.getItem('currentUser'); if(!s) return location.href='index.html'; currentUser=JSON.parse(s); if(currentUser.role!=='admin') { alert("æ— æƒ"); location.href='home.html'; } })();
    window.onload = async function() { 
        document.getElementById('admin-name').innerText = "ğŸ‘‹ "+currentUser.real_name; 
        await refreshAllData();
        setInterval(refreshAllData, 3000);
    };

    async function refreshAllData() {
        await Promise.all([ fetchUsers(), fetchAdminAnimals(), fetchAdoptions(), fetchDonations(), fetchTasks(), fetchVolunteers(), fetchLost() ]);
        initDashboard();
    }
    async function fetchAdminAnimals(){ 
        const res=await fetch(getApiUrl(SERVER_URL+"/animals")); const list=await res.json(); animalMap={};
        document.getElementById('animal-list').innerHTML = list.map(a => {
            animalMap[a.id] = a.name;
            let imgUrl = getImgUrl(a.image_url.startsWith('/') ? SERVER_URL + a.image_url : a.image_url);
            let statusBadge = a.status === 'å¾…é¢†å…»' ? 'bg-pass' : 'bg-done';
            let actionBtn = a.status === 'å¾…é¢†å…»' 
                ? `<button class="btn-delete" style="background:#6c757d;border:none" onclick="updAni(${a.id},'å·²é¢†å…»')">è®¾ä¸ºå·²é¢†å…»</button>` 
                : `<button class="btn-pass" onclick="updAni(${a.id},'å¾…é¢†å…»')">é‡ç½®çŠ¶æ€</button>`;
            return `<tr><td>${a.id}</td><td><img src="${imgUrl}" class="thumb-img"> <strong>${a.name}</strong></td><td>${a.breed || '-'}</td><td><span style="color:#007bff">${a.gender || '?'}</span> / ${a.age || '?'}</td><td>${a.health_status} <br> <span style="font-size:0.8em;color:#28a745">${a.vaccine_status || ''}</span></td><td><span class="badge ${statusBadge}">${a.status}</span></td><td>${actionBtn} <button class="btn-delete" onclick="deleteAnimal(${a.id}, '${a.name}')">ğŸ—‘ï¸</button></td></tr>`;
        }).join(''); 
    }
    async function addAnimal() {
        const name = document.getElementById('ani-name').value; const breed = document.getElementById('ani-breed').value; const age = document.getElementById('ani-age').value;
        const gender = document.getElementById('ani-gender').value; const health = document.getElementById('ani-health').value; const vaccine = document.getElementById('ani-vaccine').value;
        const personality = document.getElementById('ani-personality').value; const img = document.getElementById('ani-img').value;
        if(!name) return alert("è¯·è‡³å°‘å¡«å†™åŠ¨ç‰©åå­—ï¼");
        try {
            const res = await fetch(SERVER_URL + "/animals", { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name, breed: breed||"æœªçŸ¥", age: age||"æœªçŸ¥", gender: gender||"æœªçŸ¥", health_status: health||"å¥åº·", vaccine_status: vaccine||"æœªæ¥ç§", personality: personality||"æš‚æ— ", image_url: img||"/animals/default.jpg" }) });
            if(res.ok) { alert("âœ… å½•å…¥æˆåŠŸ"); document.querySelectorAll('.admin-form input').forEach(input => input.value = ''); refreshAllData(); } else { alert("âŒ å½•å…¥å¤±è´¥"); }
        } catch(e) { alert("ç½‘ç»œé”™è¯¯"); }
    }
    async function updAni(id,s){ if(confirm("æ”¹çŠ¶æ€?")) await fetch(SERVER_URL+`/animals/${id}/status`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({status:s})}); refreshAllData(); }
    async function deleteAnimal(id, name) { if(!confirm(`âš ï¸ ç¡®å®šåˆ é™¤åŠ¨ç‰©ã€${name}ã€‘ï¼Ÿ`)) return; await fetch(SERVER_URL + `/animals/${id}`, { method: 'DELETE' }); alert("å·²åˆ é™¤"); refreshAllData(); }
    async function fetchAdoptions() { 
        const res=await fetch(getApiUrl(SERVER_URL+"/adoptions")); const list=await res.json(); 
        document.getElementById('audit-list').innerHTML=list.reverse().map(a=>`<tr><td>${a.id}</td><td>${userMap[a.user_id]||'æœªçŸ¥'}</td><td style="color:#007bff">${a.college||'-'}</td><td style="color:#007bff">${a.student_class||'-'}</td><td style="font-weight:bold">${animalMap[a.animal_id] || `æœªçŸ¥(ID:${a.animal_id})`}</td><td>${a.apply_reason}</td><td><span class="badge ${a.status==='å¾…å®¡æ ¸'?'bg-wait':(a.status==='å·²é€šè¿‡'?'bg-pass':'bg-reject')}">${a.status}</span></td><td>${a.status==='å¾…å®¡æ ¸'?`<button class="btn-pass" onclick="audAdp(${a.id},'å·²é€šè¿‡')">é€šè¿‡</button><button class="btn-reject" onclick="audAdp(${a.id},'å·²æ‹’ç»')">æ‹’ç»</button>`:''} <button class="btn-delete" onclick="delAdp(${a.id})">ğŸ—‘ï¸</button></td></tr>`).join(''); 
    }
    async function audAdp(id,s){ if(confirm("ç¡®å®šæ“ä½œ?")) { await fetch(SERVER_URL+`/adoptions/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({status:s})}); refreshAllData(); } }
    async function delAdp(id){ if(confirm("åˆ ?")) await fetch(SERVER_URL+`/adoptions/${id}`,{method:'DELETE'}); refreshAllData(); }
    async function fetchLost(){ 
        const res=await fetch(getApiUrl(SERVER_URL+"/lost-pets")); const list=await res.json(); 
        document.getElementById('lost-list').innerHTML=list.reverse().map(p=> {
            let statusBadge = p.status === 'å¾…å®¡æ ¸' ? 'bg-wait' : (p.status === 'å·²é€šè¿‡' ? 'bg-pass' : 'bg-reject');
            let auditBtns = p.status === 'å¾…å®¡æ ¸' ? `<button class="btn-pass" onclick="auditLost(${p.id}, 'å·²é€šè¿‡')">é€šè¿‡</button><button class="btn-reject" onclick="auditLost(${p.id}, 'å·²æ‹’ç»')">æ‹’ç»</button>` : '';
            return `<tr><td>${p.id}</td><td><span class="badge ${statusBadge}">${p.status||'å¾…å®¡æ ¸'}</span></td><td><span class="badge ${p.type==='å¯»å® '?'bg-reject':'bg-pass'}">${p.type}</span></td><td>${p.title}</td><td>${p.description}</td><td>${p.contact}</td><td>${new Date(p.created_at).toLocaleDateString()}</td><td>${auditBtns} <button class="btn-delete" onclick="delLost(${p.id})">ğŸ—‘ï¸</button></td></tr>`;
        }).join(''); 
    }
    async function auditLost(id, status) { if(!confirm(`ç¡®å®šè¦å°†æ­¤æ¡ä¿¡æ¯æ ‡è®°ä¸ºã€${status}ã€‘å—ï¼Ÿ`)) return; await fetch(SERVER_URL + `/lost-pets/${id}/status`, { method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({status: status}) }); refreshAllData(); }
    async function publishLostAdmin(){ 
        const type = document.getElementById('lost-type').value; const title = document.getElementById('lost-title').value; const desc = document.getElementById('lost-desc').value; const contact = document.getElementById('lost-contact').value;
        if(!title || !desc) return alert("è¯·å¡«å†™å®Œæ•´");
        const res = await fetch(SERVER_URL+"/lost-pets",{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({type, title, description:desc, contact}) });
        const newPet = await res.json();
        await fetch(SERVER_URL + `/lost-pets/${newPet.id}/status`, { method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({status: 'å·²é€šè¿‡'}) });
        alert("âœ… å‘å¸ƒæˆåŠŸ"); document.getElementById('lost-title').value=""; document.getElementById('lost-desc').value=""; document.getElementById('lost-contact').value=""; refreshAllData(); 
    }
    async function delLost(id){ if(confirm("åˆ ?")) await fetch(SERVER_URL+`/lost-pets/${id}`,{method:'DELETE'}); refreshAllData(); }
    async function initDashboard() { try { const res=await fetch(getApiUrl(SERVER_URL+"/stats")); const data=await res.json(); document.getElementById('stat-users').innerText=data.core_metrics.total_users; document.getElementById('stat-animals').innerText=data.core_metrics.total_animals; document.getElementById('stat-donations').innerText=data.core_metrics.total_donations; document.getElementById('stat-volunteers').innerText=data.core_metrics.total_volunteers; const pie=echarts.init(document.getElementById('chart-pie')); pie.setOption({title:{text:'ğŸ¾ é¢†å…»çŠ¶æ€',left:'left',top:10},tooltip:{trigger:'item',formatter:'{b}: {c} ({d}%)'},legend:{orient:'vertical',right:10,top:'center'},color:['#91cc75','#fac858'],series:[{type:'pie',radius:['40%','65%'],center:['40%','55%'],avoidLabelOverlap:true,itemStyle:{borderRadius:4,borderColor:'#fff',borderWidth:2},label:{show:true,formatter:p=>p.value===0?'':`${p.name}\n${p.value}åª`,color:'#666'},labelLine:{show:p=>p.value!==0},data:data.animal_stats}]}); const bar=echarts.init(document.getElementById('chart-bar')); bar.setOption({title:{text:'ğŸ“ˆ æ•°æ®æ¦‚è§ˆ',left:'center',top:10},tooltip:{trigger:'axis'},xAxis:{type:'category',data:['ç”¨æˆ·','åŠ¨ç‰©','æèµ ','å¿—æ„¿è€…','å¾…å®¡']},yAxis:{type:'value'},series:[{type:'bar',barWidth:'40%',data:[data.core_metrics.total_users,data.core_metrics.total_animals,data.core_metrics.total_donations,data.core_metrics.total_volunteers,data.core_metrics.pending_adoptions],itemStyle:{color:'#5470c6'}}]}); window.onresize=()=>{pie.resize();bar.resize();}; } catch(e){} }
    async function fetchUsers(){ const res=await fetch(getApiUrl(SERVER_URL+"/users")); const list=await res.json(); userMap={}; document.getElementById('user-list').innerHTML=list.map(u=>{userMap[u.id]=u.real_name; let btn=u.role==='admin'?'<button disabled>ğŸš«</button>':`<button class="btn-kick" onclick="delUser(${u.id},'${u.real_name}')">æ³¨é”€</button>`; return `<tr><td>${u.id}</td><td>${u.real_name}</td><td>${u.role}</td><td>${new Date(u.created_at).toLocaleDateString()}</td><td>${btn}</td></tr>`}).join(''); }
    async function delUser(id,n){ if(confirm(`æ³¨é”€ ${n}?`)) await fetch(SERVER_URL+`/users/${id}`,{method:'DELETE'}); refreshAllData(); }
    async function fetchDonations(){ const res=await fetch(getApiUrl(SERVER_URL+"/donations")); const list=await res.json(); document.getElementById('donation-list').innerHTML=list.reverse().map(d=>`<tr><td>${d.id}</td><td style="font-weight:bold">${userMap[d.user_id]||`æœªçŸ¥(${d.user_id})`}</td><td style="color:#e83e8c;font-weight:bold">${d.item_name}</td><td>${d.quantity}</td><td style="color:#666">${d.remarks||'-'}</td><td style="color:#888;font-size:0.9em">${new Date(d.donate_date).toLocaleString()}</td><td><button class="btn-delete" onclick="delDonation(${d.id})">ğŸ—‘ï¸</button></td></tr>`).join(''); }
    async function delDonation(id){ if(confirm("åˆ ?")) await fetch(SERVER_URL+`/donations/${id}`,{method:'DELETE'}); refreshAllData(); }
    async function fetchTasks(){ const res=await fetch(getApiUrl(SERVER_URL+"/tasks")); const list=await res.json(); document.getElementById('task-list').innerHTML=list.reverse().map(t=>`<tr><td>${t.id}</td><td style="color:#e83e8c;font-weight:bold">${t.title}</td><td>${t.required_count}äºº</td><td><span class="badge bg-pass">æ‹›å‹Ÿä¸­</span></td><td><button class="btn-delete" onclick="delTask(${t.id})">ğŸ—‘ï¸</button></td></tr>`).join(''); }
    async function publishTask(){ const title=document.getElementById('task-title').value, desc=document.getElementById('task-desc').value, count=document.getElementById('task-count').value; if(!title||!count) return alert("è¯·å¡«å†™å®Œæ•´"); await fetch(SERVER_URL+"/tasks",{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title,description:desc,required_count:parseInt(count)})}); alert("å‘å¸ƒæˆåŠŸ"); document.getElementById('task-title').value=""; refreshAllData(); }
    async function delTask(id){ if(confirm("åˆ ?")) await fetch(SERVER_URL+`/tasks/${id}`,{method:'DELETE'}); refreshAllData(); }
    async function fetchVolunteers(){ const res=await fetch(getApiUrl(SERVER_URL+"/volunteers")); const list=await res.json(); document.getElementById('volunteer-archive').innerHTML=list.filter(v=>v.status==='å·²é€šè¿‡').map(v=>`<tr><td>${v.id}</td><td><b>${userMap[v.user_id]||'æœªçŸ¥'}</b></td><td>${v.available_time}</td><td><span class="badge bg-member">æ­£å¼</span></td><td><button class="btn-delete" onclick="delVol(${v.id})">ç§»é™¤</button></td></tr>`).join(''); document.getElementById('volunteer-audit').innerHTML=list.filter(v=>v.status!=='å·²é€šè¿‡').reverse().map(v=>`<tr><td>${v.id}</td><td>${userMap[v.user_id]||'æœªçŸ¥'}</td><td>${v.reason}</td><td><span class="badge ${v.status==='å¾…å®¡æ ¸'?'bg-wait':'bg-reject'}">${v.status}</span></td><td>${v.status==='å¾…å®¡æ ¸'?`<button class="btn-pass" onclick="audVol(${v.id},'å·²é€šè¿‡')">é€šè¿‡</button><button class="btn-reject" onclick="audVol(${v.id},'å·²æ‹’ç»')">æ‹’ç»</button>`:''} <button class="btn-delete" onclick="delVol(${v.id})">ğŸ—‘ï¸</button></td></tr>`).join(''); }
    async function audVol(id,s){ await fetch(SERVER_URL+`/volunteers/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({status:s})}); refreshAllData(); }
    async function delVol(id){ if(confirm("åˆ ?")) await fetch(SERVER_URL+`/volunteers/${id}`,{method:'DELETE'}); refreshAllData(); }
    function logout(){ localStorage.removeItem('currentUser'); location.href='index.html'; }
</script>
</body>
</html>